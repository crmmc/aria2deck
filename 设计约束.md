# 设计约束

本文档记录前端 UI 设计的约束规范。

---

## 状态管理

| 约束 | 说明 |
|------|------|
| 全局状态使用 Context | 用户信息、侧边栏展开状态等跨页面共享的状态必须使用 React Context |
| 避免页面重新渲染 | 页面切换时不应重新挂载全局组件（如侧边栏），状态应持久化 |
| Context 放置位置 | AuthContext 应在 RootLayout 层级提供，确保所有页面共享同一实例 |
| 侧边栏状态管理 | 侧边栏展开状态必须存储在 AuthContext 中，不能使用局部 state |

实现方式：
```tsx
// lib/AuthContext.tsx - 创建 Context
export const AuthContext = createContext<AuthContextType | null>(null);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [sidebarExpanded, setSidebarExpanded] = useState(false);
  // ... 其他状态

  return (
    <AuthContext.Provider value={{ sidebarExpanded, setSidebarExpanded, ... }}>
      {children}
    </AuthContext.Provider>
  );
}

// app/layout.tsx - 在根布局提供 Context
export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <Providers>
          <div className="container">{children}</div>
        </Providers>
      </body>
    </html>
  );
}

// app/(authenticated)/layout.tsx - 消费 Context
export default function AuthenticatedLayout({ children }) {
  const { user, loading, sidebarExpanded } = useAuth();

  return (
    <>
      <Sidebar user={user} />
      <div className="main-content" style={{ marginLeft: sidebarExpanded ? 240 : 64 }}>
        {children}
      </div>
    </>
  );
}

// components/Sidebar.tsx - 消费 Context
function SidebarContent({ user }) {
  const { sidebarExpanded, setSidebarExpanded } = useAuth();

  return (
    <div
      className={`sidebar ${sidebarExpanded ? "expanded" : ""}`}
      onMouseEnter={() => !sidebarExpanded && setSidebarExpanded(true)}
      onMouseLeave={() => sidebarExpanded && setSidebarExpanded(false)}
    >
      {/* 侧边栏内容 */}
    </div>
  );
}
```

**关键点**：
- ✅ 侧边栏状态存储在 AuthContext 中，页面切换时保持
- ✅ Sidebar 组件直接从 Context 读取状态，不通过 props 传递
- ✅ 页面切换时不会重新初始化侧边栏状态
- ❌ 禁止在 layout 中使用局部 `useState` 管理侧边栏状态

---

## 布局高度对齐

| 约束 | 说明 |
|------|------|
| 侧边栏与内容框高度统一 | 侧边栏和主内容框必须使用相同的高度计算方式，确保视觉对齐 |
| 统一高度值 | 使用 `height: calc(100vh - 32px)` 统一高度（上下各留 16px 边距） |
| 内容框支持滚动 | 主内容框必须添加 `overflow-y: auto` 支持内容滚动 |
| 禁止动画闪烁 | 侧边栏文字不使用 `fadeIn` 动画，避免页面切换时闪烁 |

实现方式：
```css
/* 侧边栏 */
.sidebar {
  position: fixed;
  top: 16px;
  left: 16px;
  height: calc(100vh - 32px);  /* 统一高度 */
  /* ... 其他样式 */
}

/* 主内容框 */
.glass-frame {
  height: calc(100vh - 32px);  /* 与侧边栏统一 */
  overflow-y: auto;            /* 支持滚动 */
  /* ... 其他样式 */
}

/* 主内容区域 */
.main-content {
  padding: 16px 16px 16px 0;  /* 确保顶部对齐 */
  /* ... 其他样式 */
}

/* 侧边栏文字 - 禁止动画 */
.sidebar-title,
.nav-text {
  /* 不使用 opacity: 0 和 animation: fadeIn */
  /* 直接显示，避免闪烁 */
}
```

**关键点**：
- ✅ 侧边栏和内容框使用相同的高度计算公式
- ✅ 内容框添加 `overflow-y: auto` 处理内容溢出
- ✅ 移除文字动画，避免页面切换时闪烁
- ❌ 禁止使用 `height: auto` 或 `bottom` 定位，会导致高度不一致

---

## 弹窗 (Modal)

| 约束 | 说明 |
|------|------|
| 背景不透明 | 弹窗内容区域必须使用不透明背景 (`background: #fff`)，不使用半透明玻璃效果 |
| 遮罩层 | 弹窗遮罩使用 `rgba(0,0,0,0.5)` 半透明黑色 |
| 点击遮罩关闭 | 点击遮罩层应关闭弹窗 |
| 阻止冒泡 | 弹窗内容区域点击不应触发关闭 |

示例代码：
```tsx
{/* Modal */}
{showModal && (
  <div 
    style={{
      position: "fixed",
      inset: 0,
      background: "rgba(0,0,0,0.5)",
      display: "flex",
      alignItems: "center",
      justifyContent: "center",
      zIndex: 1000
    }}
    onClick={() => setShowModal(false)}
  >
    <div 
      className="card"
      style={{ 
        maxWidth: 400,
        background: "#fff"  // 不透明背景
      }}
      onClick={e => e.stopPropagation()}
    >
      {/* Modal content */}
    </div>
  </div>
)}
```
